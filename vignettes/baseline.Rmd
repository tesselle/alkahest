---
title: "Baseline Estimation"
author: "N. Frerebeau"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    number_sections: yes
    toc: true
vignette: >
  %\VignetteIndexEntry{Baseline Estimation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(alkahest)
```

# Linear baseline

```{r linear, fig.width=7, fig.height=6, fig.cap="Linear baseline."}
## X-ray diffraction
data("XRD")

## Plot spectrum
plot(XRD, type = "l", xlab = expression(2*theta), ylab = "Count")

## Estimate baseline
baseline <- baseline_linear(XRD, points = c(25, 34))

plot(XRD, type = "l", xlab = expression(2*theta), ylab = "Count")
lines(baseline, type = "l", col = "red")

## Correct baseline
corrected <- signal_drift(XRD, lag = baseline, add = FALSE)

plot(corrected, type = "l", xlab = expression(2*theta), ylab = "Count")
```

# Polynomial baseline

```{r polynomial, fig.width=7, fig.height=6, fig.cap="Polynomial baseline"}
## X-ray diffraction
data("XRD")

## Subset from 20 to 70 degrees
XRD <- signal_select(XRD, from = 20, to = 70)

## Plot spectrum
plot(XRD, type = "l", xlab = expression(2*theta), ylab = "Count")

## Estimate baseline
baseline <- baseline_polynomial(XRD, d = 4, tolerance = 0.02, stop = 1000)

plot(XRD, type = "l", xlab = expression(2*theta), ylab = "Count")
lines(baseline, type = "l", col = "red")

## Correct baseline
corrected <- signal_drift(XRD, lag = baseline, add = FALSE)

plot(corrected, type = "l", xlab = expression(2*theta), ylab = "Count")
```

# Rubberband baseline

```{r rubberband, fig.width=7, fig.height=6, fig.cap="Rubberband baseline"}
## gamma-ray spectrometry
data("BEGe")

## Subset from 2.75 to 200 keV
BEGe <- signal_select(BEGe, from = 3, to = 200)

## Plot spectrum
plot(BEGe, type = "l", xlab = "Energy (keV)", ylab = "Count")

## Estimate baseline
baseline <- baseline_rubberband(BEGe)

plot(BEGe, type = "l", xlab = "Energy (keV)", ylab = "Count")
lines(baseline, type = "l", col = "red")

## Correct baseline
corrected <- signal_drift(BEGe, lag = baseline, add = FALSE)

plot(corrected, type = "l", xlab = expression(2*theta), ylab = "Count")
```

# SNIP baseline

```{r snip, fig.width=7, fig.height=6, fig.cap="SNIP baseline"}
## gamma-ray spectrometry
data("BEGe")

## Subset from 2.75 to 200 keV
BEGe <- signal_select(BEGe, from = 3, to = 200)

## Plot spectrum
plot(BEGe, type = "l", xlab = "Energy (keV)", ylab = "Count")

## Estimate baseline
baseline <- baseline_snip(BEGe, LLS = FALSE, decreasing = FALSE, n = 100)

plot(BEGe, type = "l", xlab = "Energy (keV)", ylab = "Count")
lines(baseline, type = "l", col = "red")

## Correct baseline
corrected <- signal_drift(BEGe, lag = baseline, add = FALSE)

plot(corrected, type = "l", xlab = expression(2*theta), ylab = "Count")
```

# 4S Peak Filling

```{r peakfilling, fig.width=7, fig.height=6, fig.cap="4S Peak Filling"}
## gamma-ray spectrometry
data("BEGe")

## Subset from 2.75 to 200 keV
BEGe <- signal_select(BEGe, from = 3, to = 200)

## Plot spectrum
plot(BEGe, type = "l", xlab = "Energy (keV)", ylab = "Count")

## Estimate baseline
baseline <- baseline_peakfilling(BEGe, n = 5, m = 5, by = 2)

plot(BEGe, type = "l", xlab = "Energy (keV)", ylab = "Count")
lines(baseline, type = "l", col = "red")

## Correct baseline
corrected <- signal_drift(BEGe, lag = baseline, add = FALSE)

plot(corrected, type = "l", xlab = expression(2*theta), ylab = "Count")
```
